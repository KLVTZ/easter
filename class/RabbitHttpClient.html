<!DOCTYPE html>
<html>
  <head>
  <meta charset='UTF-8'>
  <title>CoffeeScript API Documentation</title>
  <script src='../javascript/application.js'></script>
  <script src='../javascript/search.js'></script>
  <link rel='stylesheet' href='../stylesheets/application.css' type='text/css'>
</head>
  <body>
    <div id='base' data-path='../'></div>
<div id='header'>
  <div id='menu'>
    <a href='../extra/README.md.html' title='Easter'>
      Easter
    </a>
    &raquo;
    <a href='../alphabetical_index.html' title='Index'>
      Index
    </a>
    &raquo;
    <span class='title'>RabbitHttpClient</span>
  </div>
</div>
    <div id='content'>
      <h1>
        Class:
        RabbitHttpClient
      </h1>
      <table class='box'>
        <tr>
          <td>Defined in:</td>
          <td>src&#47;RabbitHttpClient.coffee</td>
        </tr>
        <tr>
          <td>Inherits:</td>
          <td>
            <a href='../class/Client.html'>Client</a>
          </td>
        </tr>
      </table>
      <h2>Overview</h2>
      <div class='docstring'>
  <div class='note'>
    <strong>Note:</strong>
    All message consumed by the http client off a queue are immediately ACKed! 
  </div>
  <p>Communicate with RabbitMQ server through the HTTP API which can be started
by enabling the rabbitmq management plugin.</p>
</div>
<div class='tags'>
</div>
      <h2>Variables Summary</h2>
      <dl class='constants'>
  <dt id='defaultPublishOptions-variable'>
    defaultPublishOptions
    =
  </dt>
  <dd>
    <pre><code class='coffeescript'>{}</code></pre>
    <div class='docstring'>
  <p>Default message publishing options.</p>
</div>
<div class='tags'>
</div>
  </dd>
  <dt id='defaultReadOptions-variable'>
    defaultReadOptions
    =
  </dt>
  <dd>
    <pre><code class='coffeescript'>{

  &#47;*
  How many messages to consume with one request. By default it&#39;s 1.
   *&#47;
  count: 1,

  &#47;*
  Whether to re-enqueue the messages after consumption. By default it&#39;s false.
   *&#47;
  requeue: false,

  &#47;*
  Default encoding to use for message payloads.
   *&#47;
  encoding: &#39;auto&#39;
}</code></pre>
    <div class='docstring'>
  <p>Default message consumption options.</p>
</div>
<div class='tags'>
</div>
  </dd>
</dl>
      <h3 class='inherited'>
        Variable inherited from
        <a href='../class/Client.html'>Client</a>
      </h3>
      <p class='inherited'>
        <a href='../class/Client.html#options-variable'>options</a>
      </p>
      <h2>Instance Method Summary</h2>
      <ul class='summary'>
  <li>
    <span class='signature'>
      <a href='#publish-dynamic'>
        #
(Object)
<b>publish</b><span>(queueName, data, options = {})</span>
      </a>
    </span>
    <span class='desc'>
    </span>
  </li>
  <li>
    <span class='signature'>
      <a href='#consume-dynamic'>
        #
(Object)
<b>consume</b><span>(queueName, options = {})</span>
      </a>
    </span>
    <span class='desc'>
      Retrieves a message from a RabbitMQ endpoint and consume it at the same time (ie.

    </span>
  </li>
  <li>
    <span class='signature'>
      <a href='#subscribe-dynamic'>
        #
(void)
<b>subscribe</b><span>(queueName, callback, options = {})</span>
      </a>
    </span>
    <span class='desc'>
      This method polls the queue endpoint and consumes data as soon as it appears.

    </span>
  </li>
  <li>
    <span class='signature'>
      <a href='#call-dynamic'>
        #
(Q.promise)
<b>call</b><span>(endpoint, body)</span>
      </a>
    </span>
    <span class='note private title'>Private</span>
    <span class='desc'>
      Utility method to call an HTTP endpoint given 
    </span>
  </li>
</ul>
      <h2>
        <small>Inherited Method Summary</small>
        <h3 class='inherited'>
          Methods inherited from
          <a href='../class/Client.html'>Client</a>
        </h3>
        <p class='inherited'>
          <a href='../class/Client.html#publish-dynamic'>#publish</a>
          <a href='../class/Client.html#subscribe-dynamic'>#subscribe</a>
          <a href='../class/Client.html#log-dynamic'>#log</a>
        </p>
      </h2>
      <h2>Constructor Details</h2>
      <div class='methods'>
  <div class='method_details'>
    <p class='signature' id='constructor-dynamic'>
      #
(void)
<b>constructor</b><span>(options = {})</span>
      <br>
    </p>
    <div class='docstring'>
  <p>Constructs a rabbitmq client using the http protocol</p>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>options</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (host):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Ip</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>of machine where rabbitmq server is installed. Defaults to &#39;localhost&#39;. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (port):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Port</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>where the rabbitmq server is listening. Defaults to 15672 for http. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (vhost):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Rabbitmq</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>virtual host. Defaults to &#39;/&#39;. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (login):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Username</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>to login to the api. Defaults to &#39;guest&#39; </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (password):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Password</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>to login to the api. Defaults to &#39;guest&#39; </span>
    </li>
  </ul>
</div>
  </div>
</div>
      <h2>Instance Method Details</h2>
      <div class='methods'>
  <div class='method_details'>
    <p class='signature' id='publish-dynamic'>
      #
(Object)
<b>publish</b><span>(queueName, data, options = {})</span>
      <br>
    </p>
    <div class='docstring'>
  
  <div class='examples'>
    <h3>Examples:</h3>
    <h4>
      
    </h4>
    <pre><code class='coffeescript'>curl -i -u &lt;user&gt;:&lt;pass&gt; \
     -H &#39;content-type:application&#47;json&#39; \
     -d &#39;{
            &quot;properties&quot;:&lt;options&gt;,
            &quot;routing_key&quot;:&lt;queueName&gt;,
            &quot;payload&quot;:&lt;data&gt;,
            &quot;payload_encoding&quot;:&quot;string&quot;
         }&#39; \
     -XPOST http:&#47;&#47;rabbitmq&#47;api&#47;exchanges&#47;%2f&#47;amq.default&#47;publish</code></pre>
  </div>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>queueName</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
    </li>
    <li>
      <span class='name'>queueOpts</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
    </li>
  </ul>
  <h3>Returns:</h3>
  <ul class='return'>
    <li>
      <span class='type'></span>
      (
        <tt>Object</tt>
      )
      &mdash;
      <span class='desc'>Q.Promise resolving to a Queue instance. </span>
    </li>
  </ul>
</div>
  </div>
  <div class='method_details'>
    <p class='signature' id='consume-dynamic'>
      #
(Object)
<b>consume</b><span>(queueName, options = {})</span>
      <br>
    </p>
    <div class='docstring'>
  <p>Retrieves a message from a RabbitMQ endpoint and
consume it at the same time (ie. send ACK).</p>
  <div class='examples'>
    <h3>Examples:</h3>
    <h4>
      
    </h4>
    <pre><code class='coffeescript'>curl -i -u vibetrace:V2PBCZLa0dS2 \
     -H &#39;content-type:application&#47;json&#39; \
     -d &#39;{
            &quot;count&quot;:1,
            &quot;requeue&quot;:false,
            &quot;encoding&quot;:&quot;auto&quot;
         }&#39; \
     -XPOST http:&#47;&#47;rabbitmq&#47;api&#47;queues&#47;%2f&#47;&lt;queueName&gt;&#47;get</code></pre>
  </div>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>queueName</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'><ul> name of the queue to subscribe to.
</ul>
</span>
    </li>
    <li>
      <span class='name'>options</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'><ul> list of options to read
</ul>
</span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (count):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>How</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>many messages to consume with one request. By default it&#39;s 1. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (requeue):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Whether</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>to re-enqueue the messages after consumption. By default it&#39;s false. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (encoding):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Default</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>encoding to use for message payloads. </span>
    </li>
  </ul>
  <h3>Returns:</h3>
  <ul class='return'>
    <li>
      <span class='type'></span>
      (
        <tt>Object</tt>
      )
      &mdash;
      <span class='desc'>Q.Promise resolves to an Array<String> of messages. </span>
    </li>
  </ul>
</div>
  </div>
  <div class='method_details'>
    <p class='signature' id='subscribe-dynamic'>
      #
(void)
<b>subscribe</b><span>(queueName, callback, options = {})</span>
      <br>
    </p>
    <div class='docstring'>
  <p>This method polls the queue endpoint and consumes data as soon as
it appears.</p><p>It implements a fibonacci polling mechanism to
ensure efficient bandwidth consumption, ie. whenever a call to
the queue returns empty results, it will wait that much longer
before calling again. If the call returns data, it will fetch more
data immediately after consumption.</p><p>To implement the api of the native rabbitmq client, the callback
executed for each message also receives the ack function which it
will call whenever the message is consumed. This is fake as
the message is already consumed by the time it reaches the callback.</p>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>queueName</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>The queue will be created if it does not exist. </span>
    </li>
    <li>
      <span class='name'>callback</span>
      <span class='type'>
        (
          <tt>Function</tt>
        )
      </span>
      &mdash;
      <span class='desc'>whenever a new message is retrieved this callback is executed. Signature: function (error, message, ack) {..} </span>
    </li>
    <li>
      <span class='name'>options</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>extra params </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (count):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>Number</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>of messages to consume. Defaults to 10. </span>
    </li>
  </ul>
</div>
  </div>
  <div class='method_details'>
    <p class='signature' id='call-dynamic'>
      #
(Q.promise)
<b>call</b><span>(endpoint, body)</span>
      <span class='note private'>Private</span>
      <br>
    </p>
    <div class='docstring'>
  <p>Utility method to call an HTTP endpoint given</p>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>endpoint</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Http path&amp;query string of the url to call. </span>
    </li>
    <li>
      <span class='name'>body</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Http request body. </span>
    </li>
  </ul>
  <h3>Returns:</h3>
  <ul class='return'>
    <li>
      <span class='type'></span>
      (
        <tt>Q.promise</tt>
      )
      &mdash;
      <span class='desc'>Resolves when the call is completed. </span>
    </li>
  </ul>
</div>
  </div>
</div>
    </div>
    <div id='footer'>
  February 01, 15 15:41:33 by
  <a href='https://github.com/coffeedoc/codo' title='CoffeeScript API documentation generator'>
    Codo
  </a>
  2.0.9
  &#10034;
  Press H to see the keyboard shortcuts
  &#10034;
  <a href='http://twitter.com/netzpirat' target='_parent'>@netzpirat</a>
  &#10034;
  <a href='http://twitter.com/_inossidabile' target='_parent'>@_inossidabile</a>
</div>
<iframe id='search_frame'></iframe>
<div id='fuzzySearch'>
  <input type='text'>
  <ol></ol>
</div>
<div id='help'>
  <p>
    Quickly fuzzy find classes, mixins, methods, file:
  </p>
  <ul>
    <li>
      <span>T</span>
      Open fuzzy finder dialog
    </li>
  </ul>
  <p>
    Control the navigation frame:
  </p>
  <ul>
    <li>
      <span>L</span>
      Toggle list view
    </li>
    <li>
      <span>C</span>
      Show class list
    </li>
    <li>
      <span>I</span>
      Show mixin list
    </li>
    <li>
      <span>F</span>
      Show file list
    </li>
    <li>
      <span>M</span>
      Show method list
    </li>
    <li>
      <span>E</span>
      Show extras list
    </li>
  </ul>
  <p>
    You can focus and blur the search input:
  </p>
  <ul>
    <li>
      <span>S</span>
      Focus search input
    </li>
    <li>
      <span>Esc</span>
      Blur search input
    </li>
  </ul>
</div>
  </body>
</html>